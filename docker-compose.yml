version: '3.8'

services:
  # 1. Backend Service (Express/Node.js)
  backend:
    build: 
      context: ./server/    
    container_name: competiquest_backend
    ports:
      - '5000:5000'         
    environment:
      # CRITICAL: Atlas URI, JWT Secret, and Port are injected here
      MONGO_URI: $MONGO_URI
      JWT_SECRET: $JWT_SECRET
      PORT: 5000
      GEMINI_API_KEY: $GEMINI_API_KEY
    networks:
      - competiquest-network

  # 2. Frontend Service (Next.js)
  frontend:
    build: 
      context: ./client/CompetiQuest-frontend_integration/ 
      # CRITICAL: Pass NEXT_PUBLIC_API_URL as a build argument
      args:
        NEXT_PUBLIC_API_URL: $NEXT_PUBLIC_API_URL
    container_name: competiquest_frontend
    ports:
      - '3000:3000'           
    environment:
      # This is for runtime environment, matching the build arg
      NEXT_PUBLIC_API_URL: $NEXT_PUBLIC_API_URL
    depends_on:
      - backend
    networks:
      - competiquest-network

networks:
  competiquest-network:
    driver: bridge