# Final docker-compose.yml for Render

services:
  # 1. Backend Service
  backend:
    build: 
      context: ./server/    
    container_name: competiquest_backend
    # Removed ports: 5000:5000 - Render handles internal port mapping
    environment:
      # These variables are injected from the Render environment/secrets file
      MONGO_URI: $MONGO_URI
      JWT_SECRET: $JWT_SECRET
      PORT: 5000
      GEMINI_API_KEY: $GEMINI_API_KEY
      NODE_ENV: $NODE_ENV # Pass the production environment flag
    restart: always
    networks:
      - competiquest-network

  # 2. Frontend Service
  frontend:
    build: 
      context: ./client/CompetiQuest-frontend_integration/ 
      args:
        NEXT_PUBLIC_API_URL: $NEXT_PUBLIC_API_URL
    container_name: competiquest_frontend
    # Removed ports: 3000:3000
    environment:
      NEXT_PUBLIC_API_URL: $NEXT_PUBLIC_API_URL
      NODE_ENV: $NODE_ENV # Pass the production environment flag
    depends_on:
      - backend
    restart: always
    networks:
      - competiquest-network

networks:
  competiquest-network:
    driver: bridge
